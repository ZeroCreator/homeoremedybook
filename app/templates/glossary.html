{% extends "base.html" %}

{% block title %}Справочник{% endblock %}

{% block left_menu %}
    {% for term, data in terms.items() %}
        <a href="#{{ data.slug }}" class="menu-term-link" data-target="{{ data.slug }}">{{ term }}</a>
    {% endfor %}
{% endblock %}

{% block content %}
    <h1>Глоссарий терминов</h1>

    <div class="glossary-container">
        {% for term, data in terms.items() %}
            <div class="glossary-term" id="{{ data.slug }}">
                <button class="glossary-term-header" onclick="toggleTerm(this)">
                    {{ term }}
                </button>
                <div class="glossary-term-content" style="display: none;">
                    {{ data.content|safe }}
                </div>
            </div>
        {% endfor %}
    </div>

    <script>
        function toggleTerm(element) {
            // Обрабатываем как клик по кнопке, так и клик по ссылке в меню
            const content = element.classList.contains('glossary-term-header')
                ? element.nextElementSibling
                : document.querySelector(`#${element.dataset.target} .glossary-term-content`);

            if (content) {
                content.style.display = content.style.display === 'none' ? 'block' : 'none';
            }
        }

        // Обработчики событий
        document.addEventListener('DOMContentLoaded', function() {
            // Назначаем обработчики для ссылок в меню
            document.querySelectorAll('.menu-term-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault(); // Отменяем стандартное поведение ссылки
                    toggleTerm(this);
                    window.location.hash = this.getAttribute('href'); // Обновляем хэш в URL
                });
            });

            // Автоматически раскрываем термин при загрузке страницы с хэшем
            if (window.location.hash) {
                const termId = window.location.hash.substring(1);
                const content = document.querySelector(`#${termId} .glossary-term-content`);
                if (content) content.style.display = 'block';
            }
        });
    </script>
{% endblock %}
